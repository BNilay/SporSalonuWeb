@model IEnumerable<yeniWeb.Models.Randevu>
@using yeniWeb.Models

@{
    ViewData["Title"] = "Randevular";

    string DurumTr(RandevuDurumu d) => d switch
    {
        RandevuDurumu.Beklemede => "Beklemede",
        RandevuDurumu.Onaylandi => "Onaylandı",
        _ => "İptal"
    };
}

<div class="page-bg">
    <div class="container">
        <div class="content-card">

            <div class="d-flex flex-wrap justify-content-between align-items-center gap-2 mb-4">
                <div>
                    <h2 class="mb-1">Randevular</h2>
                    <div class="text-muted">Randevuları görüntüleyin, onaylayın veya iptal edin.</div>
                </div>

                <a asp-action="Create" class="btn btn-primary">
                    Yeni Randevu
                </a>
            </div>

            <div class="table-responsive">
                <table class="table table-hover align-middle mb-0">
                    <thead class="table-light">
                        <tr>
                            <th>Üye</th>
                            <th>Antrenör</th>
                            <th>Hizmet</th>
                            <th>Tarih</th>
                            <th>Saat</th>
                            <th>Süre (dk)</th>
                            <th>Ücret</th>
                            <th>Durum</th>
                            <th class="text-end" style="width: 320px;">İşlemler</th>
                        </tr>
                    </thead>
                    <tbody>
                        @if (!Model.Any())
                        {
                            <tr>
                                <td colspan="9" class="text-center text-muted py-4">
                                    Henüz randevu yok.
                                </td>
                            </tr>
                        }
                        else
                        {
                            foreach (var r in Model)
                            {
                                var bitis = r.RandevuTarihi.AddMinutes(r.SureDakika);

                                <tr>
                                    <td>@(r.Uye?.AdSoyad ?? "-")</td>
                                    <td>@(r.Antrenor?.AdSoyad ?? "-")</td>
                                    <td>@(r.Hizmet?.HizmetAdi ?? "-")</td>
                                    <td>@r.RandevuTarihi.ToString("dd.MM.yyyy")</td>
                                    <td>
                                        @r.RandevuTarihi.ToString("HH:mm") - @bitis.ToString("HH:mm")
                                    </td>
                                    <td>@r.SureDakika</td>
                                    <td>@r.Ucret ₺</td>
                                    <td>
                                        <span class="badge
                                            @(r.Durum == RandevuDurumu.Onaylandi ? "bg-success" :
                                              r.Durum == RandevuDurumu.Iptal ? "bg-danger" : "bg-warning")">
                                            @DurumTr(r.Durum)
                                        </span>
                                    </td>
                                    <td class="text-end">
                                        <div class="d-inline-flex flex-wrap gap-2 justify-content-end">

                                            @if (User.IsInRole("Admin"))
                                            {
                                                <form asp-action="Onayla" asp-route-id="@r.Id" method="post" class="d-inline">
                                                    @Html.AntiForgeryToken()
                                                    <button class="btn btn-success btn-sm">Onayla</button>
                                                </form>

                                                <form asp-action="AdminIptal" asp-route-id="@r.Id" method="post" class="d-inline">
                                                    @Html.AntiForgeryToken()
                                                    <button class="btn btn-warning btn-sm">İptal</button>
                                                </form>
                                            }

                                            <a asp-action="Delete"
                                               asp-route-id="@r.Id"
                                               class="btn btn-danger btn-sm">
                                                Sil
                                            </a>
                                        </div>
                                    </td>
                                </tr>
                            }
                        }
                    </tbody>
                </table>
            </div>

        </div>
    </div>
</div>
